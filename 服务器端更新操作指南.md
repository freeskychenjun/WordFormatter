# 服务器端更新操作指南

根据程序的自动更新机制（`update_manager.py`），当您更新了程序后，需要在服务器端执行以下操作：

## 1. 更新XML版本文件

程序会从配置的`update_check_url`（默认：`http://172.14.60.197/update.xml`）获取更新信息。您需要更新此XML文件，包含以下内容：

```xml
<update>
    <version>1.1.2</version>  <!-- 新的版本号 -->
    <url>http://172.14.60.197/Wordformatter_V1.1.2.zip</url>  <!-- 更新包下载地址 -->
    <notes>本次更新包含以下内容：
1. 修复了格式处理的bug
2. 优化了性能
3. 新增了xxx功能
    </notes>  <!-- 更新说明 -->
</update>
```

**注意：**
- 程序默认自动启用更新功能，无需用户手动开启

## 2. 准备更新包

根据代码分析，程序支持两种更新包格式：
- `.exe`：可执行安装程序
- `.zip`：压缩包格式

您需要将新的程序版本打包成上述格式之一，并上传到XML文件中指定的URL地址。

### 命名规范
更新包文件名必须遵循以下格式：
```
Wordformatter_V{版本号}.zip  # 例如：Wordformatter_V1.1.2.zip
```

**注意：** 程序代码中硬编码使用此命名格式，必须严格遵守，否则客户端无法正确识别更新包。

### 存放位置
更新包应上传到服务器的`/wordformatter/`目录下，与`update.xml`文件位于同一目录。

## 3. 确保下载服务器正常运行

确保存放更新包的Web服务器正常运行，并且更新包可以通过指定的URL正常下载。

注意：服务器目录结构应为：
```
http://172.14.60.197/
└── wordformatter/
    ├── update.xml       # 版本信息文件
    ├── Wordformatter_V1.0.0.zip  # 旧版本更新包文件
    ├── Wordformatter_V1.0.1.zip  # 旧版本更新包文件
    └── Wordformatter_V1.1.2.zip  # 当前版本更新包文件
```

## 4. 版本号管理

当前程序版本：1.1.2

版本号格式为X.Y.Z（主版本号.次版本号.修订号），程序会自动比较版本号大小来判断是否需要更新。

**注意：** 新版本号必须大于当前版本号才能被客户端识别为更新。

## 5. 更新流程说明

当客户端程序运行时：
1. 会检查`update.xml`文件获取最新版本信息
2. 比较本地版本与服务器版本
3. 如果有新版本，会下载更新包并提示用户安装
4. 根据更新包类型执行不同的安装逻辑

## 注意事项

1. 确保XML文件格式正确，避免解析错误
2. 更新包文件大小不宜过大，以免下载时间过长
3. 建议在更新前备份旧版本的XML文件和更新包
4. 测试更新流程，确保客户端能够正常检测到更新并完成安装

以上步骤完成后，客户端程序在下次启动或检查更新时，就会检测到新版本并提示用户进行更新。